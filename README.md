# Система распознавания лиц с RTSP и голосовым уведомлением

## Оглавление

* [Предварительные требования](#предварительные-требования)
* [Как это работает](#как-это-работает)
* [Советы и улучшения](#советы-и-улучшения)

---

## Предварительные требования

### 1. Установка библиотек

Выполните команду:

```bash
pip install opencv-python face-recognition flask gtts playsound
```

Используемые компоненты:

* **opencv-python** — захват и обработка видеопотока
* **face-recognition** — извлечение и сравнение лиц
* **flask** — веб-сервер
* **gtts** — генерация голоса
* **playsound** — воспроизведение звука

### 2. База данных лиц

Создайте папку:

```
known_faces/
```

Поместите туда изображения:

```
person1.jpg
person2.jpg
...
```

Каждое изображение — одно лицо. При старте будет выполнено извлечение embeddings.

### 3. RTSP URL

В коде замените `rtsp_url` на ваш реальный поток из Trassir.

### 4. Запуск системы

При запуске система:

* обрабатывает поток в отдельном потоке
* запускает веб-сервер на [http://localhost:5000](http://localhost:5000)

---

## Как это работает

### 1. Загрузка базы лиц

* программа сканирует папку `known_faces`
* извлекает embeddings через `face_recognition`
* кеширует в памяти

### 2. Обработка RTSP-потока

* кадры уменьшаются для ускорения
* находятся лица
* сравниваются с известными encodings
* если разница < `0.6` → считается совпадением

При совпадении система:

* добавляет событие в список
* генерирует речь (`gTTS`)
* воспроизводит аудио локально

### 3. Веб-интерфейс

* сервер Flask на порту `5000`
* страница выводит последние оповещения
* обновление — через JS polling

---

## Советы и улучшения

### Производительность

* уменьшайте частоту обработки кадров (добавьте задержку)
* уменьшайте размер кадра при обработке

### Работа с RTSP

* проверьте поток через VLC
* учитывайте авторизацию в Trassir

### Работа с большой базой лиц

Кешируйте embeddings в pickle:

```python
pickle.dump(encodings, open("faces.pkl", "wb"))
```

```python
encodings = pickle.load(open("faces.pkl", "rb"))
```

### Голос в браузере

Если требуется воспроизведение в веб-интерфейсе:

* сохраняйте звуковые файлы на сервере
* отдавайте через `/static`
* воспроизводите через JS Audio()

### Безопасность

Не используйте публично без HTTPS и авторизации.
